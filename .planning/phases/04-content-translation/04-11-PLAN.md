---
phase: 04-content-translation
plan: 11
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/settings/AlertRuleDialog.tsx
  - frontend/src/pages/AlertSettings.tsx
  - frontend/src/components/settings/AlertRulesManager.tsx
  - frontend/public/locales/en/settings.json
  - frontend/public/locales/zh-TW/settings.json
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Alert Rule dialog (Create/Edit) displays all form fields in selected language"
    - "Toast messages for alert rule operations translate correctly"
    - "Alert Settings page title and buttons translate"
    - "Success and error messages appear in selected language"
  artifacts:
    - path: "frontend/src/components/settings/AlertRuleDialog.tsx"
      provides: "Alert rule form translations"
      contains: "useTranslation.*settings"
    - path: "frontend/src/pages/AlertSettings.tsx"
      provides: "Alert settings page and toast translations"
      contains: "useTranslation.*settings"
    - path: "frontend/src/components/settings/AlertRulesManager.tsx"
      provides: "Alert rules manager toast translations"
      contains: "useTranslation.*settings"
    - path: "frontend/public/locales/en/settings.json"
      provides: "English keys for alerts UI and toast messages"
      contains: "alertRuleDialog"
    - path: "frontend/public/locales/zh-TW/settings.json"
      provides: "Chinese translations for alerts UI and toast messages"
      contains: "alertRuleDialog"
  key_links:
    - from: "frontend/src/components/settings/AlertRuleDialog.tsx"
      to: "frontend/public/locales/*/settings.json"
      via: "useTranslation('settings')"
      pattern: "alertRuleDialog\\."
    - from: "frontend/src/pages/AlertSettings.tsx"
      to: "frontend/public/locales/*/settings.json"
      via: "toast message translation"
      pattern: "alerts\\.toast\\."
    - from: "frontend/src/components/settings/AlertRulesManager.tsx"
      to: "frontend/public/locales/*/settings.json"
      via: "toast message translation"
      pattern: "alerts\\.toast\\."
---

<objective>
Translate Alert Rules dialog, toast messages, and Alert Settings page to close UAT gaps.

Purpose: Fix UAT Test 13 and Test 16 failures:
- Test 13: Toast error messages hardcoded in English
- Test 16: Alert Rule dialog (Create/Edit) and all form fields in English

Output: Complete i18n integration for Alert Rules feature with all UI text and feedback messages translated.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-content-translation/04-02-SUMMARY.md
@.planning/phases/04-content-translation/04-06-SUMMARY.md

**Pattern established in 04-02 and 04-06:**
- Settings page uses 'settings' namespace
- Alert rules table translations already exist in settings.json
- Document type enums already translated in 04-06

**Gaps from UAT:**

Test 13: "A toast message in English appear: Failed to save alert rule"
- AlertSettings.tsx: 6 hardcoded toast messages (lines 31, 68, 71, 78, 87, 91)
- AlertRulesManager.tsx: 7 hardcoded toast messages (lines 51, 64, 85, 92, 95, 104, 108)
- Total: 13 toast messages to translate

Test 16: "popup Window to edit the rule or add rule is in English: Create Alert Rule, Edit Alert Rule, all form fields. Toast message as well: Alert rule updated"
- AlertRuleDialog.tsx: 21 hardcoded strings (no i18n integration)
- Overlaps with AlertSettings.tsx toast messages from Test 13

**Reference files to review:**
@frontend/src/components/settings/AlertRuleDialog.tsx
@frontend/src/pages/AlertSettings.tsx
@frontend/src/components/settings/AlertRulesManager.tsx
@frontend/public/locales/en/settings.json
@frontend/public/locales/zh-TW/settings.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Alert Rule dialog and toast translation keys</name>
  <files>
    frontend/public/locales/en/settings.json
    frontend/public/locales/zh-TW/settings.json
  </files>
  <action>
Add comprehensive translation keys for Alert Rule dialog and toast messages to both locale files.

**In en/settings.json, add:**
```json
"alerts": {
  "page": {
    "title": "Alert Settings",
    "subtitle": "Manage notification rules for document expiration",
    "addButton": "Add Alert Rule"
  },
  "dialog": {
    "createTitle": "Create Alert Rule",
    "editTitle": "Edit Alert Rule",
    "description": "Set up automated alerts for expiring documents",
    "fields": {
      "documentType": {
        "label": "Document Type",
        "placeholder": "Select document type"
      },
      "condition": {
        "label": "Alert Condition",
        "placeholder": "Select condition"
      },
      "daysThreshold": {
        "label": "Days Threshold",
        "placeholder": "Enter number of days"
      },
      "status": {
        "label": "Status",
        "placeholder": "Select status"
      }
    },
    "conditions": {
      "expiresBefore": "Expires Before",
      "expiresAfter": "Expires After"
    },
    "statuses": {
      "active": "Active",
      "inactive": "Inactive"
    },
    "buttons": {
      "cancel": "Cancel",
      "create": "Create",
      "save": "Save Changes"
    }
  },
  "toast": {
    "loadError": "Failed to load alert rules",
    "createSuccess": "Alert rule created successfully",
    "updateSuccess": "Alert rule updated successfully",
    "saveError": "Failed to save alert rule",
    "deleteSuccess": "Alert rule deleted successfully",
    "deleteError": "Failed to delete alert rule"
  },
  "deleteConfirm": {
    "title": "Delete Alert Rule",
    "description": "Are you sure you want to delete this alert rule? This action cannot be undone.",
    "cancel": "Cancel",
    "confirm": "Delete"
  }
}
```

**In zh-TW/settings.json, add:**
```json
"alerts": {
  "page": {
    "title": "提醒設定",
    "subtitle": "管理文件到期通知規則",
    "addButton": "新增提醒規則"
  },
  "dialog": {
    "createTitle": "建立提醒規則",
    "editTitle": "編輯提醒規則",
    "description": "設定文件到期自動提醒",
    "fields": {
      "documentType": {
        "label": "文件類型",
        "placeholder": "選擇文件類型"
      },
      "condition": {
        "label": "提醒條件",
        "placeholder": "選擇條件"
      },
      "daysThreshold": {
        "label": "天數門檻",
        "placeholder": "輸入天數"
      },
      "status": {
        "label": "狀態",
        "placeholder": "選擇狀態"
      }
    },
    "conditions": {
      "expiresBefore": "到期前",
      "expiresAfter": "到期後"
    },
    "statuses": {
      "active": "啟用",
      "inactive": "停用"
    },
    "buttons": {
      "cancel": "取消",
      "create": "建立",
      "save": "儲存變更"
    }
  },
  "toast": {
    "loadError": "載入提醒規則失敗",
    "createSuccess": "提醒規則建立成功",
    "updateSuccess": "提醒規則更新成功",
    "saveError": "儲存提醒規則失敗",
    "deleteSuccess": "提醒規則刪除成功",
    "deleteError": "刪除提醒規則失敗"
  },
  "deleteConfirm": {
    "title": "刪除提醒規則",
    "description": "確定要刪除此提醒規則嗎？此操作無法復原。",
    "cancel": "取消",
    "confirm": "刪除"
  }
}
```

Preserve all existing settings.json structure and add alerts as a new top-level key.
  </action>
  <verify>
Check both files have valid JSON syntax:
```bash
cd frontend && npm run build
```
No JSON parse errors should occur.
  </verify>
  <done>Both settings.json locale files contain complete alerts section with dialog, toast, and page translations.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate i18n in AlertRuleDialog component</name>
  <files>frontend/src/components/settings/AlertRuleDialog.tsx</files>
  <action>
Read AlertRuleDialog.tsx and integrate i18n throughout the component.

1. Import useTranslation hook at the top:
```typescript
import { useTranslation } from 'react-i18next';
```

2. Inside the component function, add:
```typescript
const { t } = useTranslation('settings');
```

3. Replace all 21 hardcoded English strings with t() calls:

**Dialog structure:**
- Dialog title: `rule ? t('alerts.dialog.editTitle') : t('alerts.dialog.createTitle')`
- Dialog description: t('alerts.dialog.description')

**Form fields:**
- Document Type label: t('alerts.dialog.fields.documentType.label')
- Document Type placeholder: t('alerts.dialog.fields.documentType.placeholder')
- Condition label: t('alerts.dialog.fields.condition.label')
- Condition placeholder: t('alerts.dialog.fields.condition.placeholder')
- Days Threshold label: t('alerts.dialog.fields.daysThreshold.label')
- Days Threshold placeholder: t('alerts.dialog.fields.daysThreshold.placeholder')
- Status label: t('alerts.dialog.fields.status.label')
- Status placeholder: t('alerts.dialog.fields.status.placeholder')

**Select options:**
- Condition options: t('alerts.dialog.conditions.expiresBefore'), t('alerts.dialog.conditions.expiresAfter')
- Status options: t('alerts.dialog.statuses.active'), t('alerts.dialog.statuses.inactive')
- Document types: Use existing document type enum translations from common or settings namespace (already translated in 04-06)

**Buttons:**
- Cancel button: t('alerts.dialog.buttons.cancel')
- Submit button: `rule ? t('alerts.dialog.buttons.save') : t('alerts.dialog.buttons.create')`

Preserve all existing form validation, state management, submission logic, and styling.
  </action>
  <verify>
1. Check import statement exists:
```bash
grep "useTranslation" frontend/src/components/settings/AlertRuleDialog.tsx
```

2. Verify no hardcoded dialog strings remain:
```bash
grep -E '"(Create Alert Rule|Edit Alert Rule|Document Type|Condition|Days|Status)"' frontend/src/components/settings/AlertRuleDialog.tsx
```
Should return minimal or no matches (only prop names allowed).

3. Build succeeds:
```bash
cd frontend && npm run build
```
  </verify>
  <done>AlertRuleDialog.tsx uses useTranslation('settings') hook and all UI strings replaced with t() calls.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate i18n toast messages in AlertSettings page</name>
  <files>frontend/src/pages/AlertSettings.tsx</files>
  <action>
Read AlertSettings.tsx and replace all hardcoded toast messages and page text.

1. Import useTranslation hook at the top:
```typescript
import { useTranslation } from 'react-i18next';
```

2. Inside the component function, add:
```typescript
const { t } = useTranslation('settings');
```

3. Replace page header text:
- Page title: t('alerts.page.title')
- Page subtitle: t('alerts.page.subtitle')
- Add button label: t('alerts.page.addButton')

4. Replace all 6 toast messages (lines 31, 68, 71, 78, 87, 91):
- Load error: `toast.error(t('alerts.toast.loadError'))`
- Create success: `toast.success(t('alerts.toast.createSuccess'))`
- Update success: `toast.success(t('alerts.toast.updateSuccess'))`
- Save error: `toast.error(t('alerts.toast.saveError'))`
- Delete success: `toast.success(t('alerts.toast.deleteSuccess'))`
- Delete error: `toast.error(t('alerts.toast.deleteError'))`

5. Replace delete confirmation dialog text:
- Title: t('alerts.deleteConfirm.title')
- Description: t('alerts.deleteConfirm.description')
- Cancel button: t('alerts.deleteConfirm.cancel')
- Confirm button: t('alerts.deleteConfirm.confirm')

Preserve all existing alert rule CRUD logic, state management, and UI behavior.
  </action>
  <verify>
1. Check import statement exists:
```bash
grep "useTranslation" frontend/src/pages/AlertSettings.tsx
```

2. Verify no hardcoded toast strings:
```bash
grep 'toast\.\(error\|success\)("' frontend/src/pages/AlertSettings.tsx
```
Should return no matches (all should use t()).

3. Build succeeds:
```bash
cd frontend && npm run build
```
  </verify>
  <done>AlertSettings.tsx uses useTranslation('settings') hook and all page text and toast messages replaced with t() calls.</done>
</task>

<task type="auto">
  <name>Task 4: Integrate i18n toast messages in AlertRulesManager component</name>
  <files>frontend/src/components/settings/AlertRulesManager.tsx</files>
  <action>
Read AlertRulesManager.tsx and replace all 7 hardcoded toast messages.

1. Import useTranslation hook at the top (if not already present):
```typescript
import { useTranslation } from 'react-i18next';
```

2. Inside the component function, add:
```typescript
const { t } = useTranslation('settings');
```

3. Replace all 7 toast messages (lines 51, 64, 85, 92, 95, 104, 108) using the same keys from Task 3:
- Load error: `toast.error(t('alerts.toast.loadError'))`
- Create success: `toast.success(t('alerts.toast.createSuccess'))`
- Update success: `toast.success(t('alerts.toast.updateSuccess'))`
- Save error: `toast.error(t('alerts.toast.saveError'))`
- Delete success: `toast.success(t('alerts.toast.deleteSuccess'))`
- Delete error: `toast.error(t('alerts.toast.deleteError'))`

Note: If AlertRulesManager has duplicate toast calls with AlertSettings, consolidate to use the same translation keys for consistency.

Preserve all existing alert rules management logic, table rendering, and event handlers.
  </action>
  <verify>
1. Check import statement exists:
```bash
grep "useTranslation" frontend/src/components/settings/AlertRulesManager.tsx
```

2. Verify no hardcoded toast strings:
```bash
grep 'toast\.\(error\|success\)("' frontend/src/components/settings/AlertRulesManager.tsx
```
Should return no matches.

3. Build succeeds:
```bash
cd frontend && npm run build
```
  </verify>
  <done>AlertRulesManager.tsx uses useTranslation('settings') hook and all toast messages replaced with t() calls.</done>
</task>

</tasks>

<verification>
1. Visit Settings page, navigate to Alert Settings
2. Switch language to Traditional Chinese
3. Verify page title shows "提醒設定"
4. Click "新增提醒規則" button - dialog should show Chinese title and labels
5. Submit form - verify toast message appears in Chinese
6. Edit an existing rule - verify "編輯提醒規則" dialog shows Chinese text
7. Delete a rule - verify confirmation dialog and toast in Chinese
8. Switch back to English and verify all text displays in English
</verification>

<success_criteria>
- Alert Rule dialog (Create/Edit) fully translated with all form fields
- All toast messages for CRUD operations display in selected language
- Alert Settings page title, subtitle, and buttons translate correctly
- Delete confirmation dialog translates properly
- UAT Test 13 and Test 16 gaps closed: Alert Rules feature fully translated
</success_criteria>

<output>
After completion, create `.planning/phases/04-content-translation/04-11-SUMMARY.md`
</output>

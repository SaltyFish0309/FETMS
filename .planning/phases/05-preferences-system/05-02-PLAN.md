---
phase: 05-preferences-system
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - frontend/src/index.css
  - frontend/src/contexts/PreferencesContext.tsx
  - frontend/src/pages/PreferencesSettings.tsx
  - frontend/public/locales/en/settings.json
  - frontend/public/locales/zh-TW/settings.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can select Small/Medium/Large font size from Settings"
    - "Font size change applies immediately without page refresh"
    - "All text across the application scales appropriately"
    - "Font size preference persists across browser sessions"
  artifacts:
    - path: "frontend/src/index.css"
      provides: "CSS custom properties for font-size-scale"
      contains: "data-font-size"
    - path: "frontend/src/pages/PreferencesSettings.tsx"
      provides: "Font size control UI"
      contains: "fontSize"
  key_links:
    - from: "frontend/src/contexts/PreferencesContext.tsx"
      to: "document.documentElement"
      via: "setAttribute data-font-size"
      pattern: "setAttribute.*data-font-size"
    - from: "frontend/src/pages/PreferencesSettings.tsx"
      to: "frontend/src/contexts/PreferencesContext.tsx"
      via: "usePreferences hook"
      pattern: "usePreferences"
---

<objective>
Implement font size preference control that scales all text across the application.

Purpose: Users with different visual needs or preferences can adjust text size globally. Small for dense information, Large for accessibility/readability.

Output: Working font size toggle (Small/Medium/Large) in Settings with immediate visual effect and localStorage persistence.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-preferences-system/05-RESEARCH.md
@.planning/phases/05-preferences-system/05-CONTEXT.md
@frontend/src/index.css
@frontend/src/contexts/PreferencesContext.tsx
@frontend/src/pages/PreferencesSettings.tsx
@frontend/public/locales/en/settings.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CSS custom properties for font size scaling</name>
  <files>frontend/src/index.css</files>
  <action>
Add CSS custom properties that scale font size based on data-font-size attribute.

**Add to :root section (after existing CSS variables, before .dark section):**

```css
/* Font Size Scaling */
:root {
  --font-size-scale: 1;
}

:root[data-font-size="small"] {
  --font-size-scale: 0.875;
}

:root[data-font-size="medium"] {
  --font-size-scale: 1;
}

:root[data-font-size="large"] {
  --font-size-scale: 1.125;
}
```

**Modify the body rule in @layer base:**

Change:
```css
body {
  @apply bg-background text-foreground font-sans antialiased;
}
```

To:
```css
body {
  @apply bg-background text-foreground font-sans antialiased;
  font-size: calc(1rem * var(--font-size-scale));
}
```

**Scaling rationale from RESEARCH.md:**
- small: 0.875 (14px base) - more content fits on screen
- medium: 1.0 (16px base) - browser default
- large: 1.125 (18px base) - easier to read

This approach scales ALL text proportionally since components use rem units.
  </action>
  <verify>
Manually add `data-font-size="large"` to html element in DevTools and verify body font size increases.
Run: `npm run build --prefix frontend` to verify CSS builds without errors.
  </verify>
  <done>
CSS custom properties --font-size-scale defined for small/medium/large variants. Body font-size uses calc() with the scale variable.
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply data-font-size attribute from PreferencesContext</name>
  <files>frontend/src/contexts/PreferencesContext.tsx</files>
  <action>
Add a useEffect in PreferencesProvider that sets the data-font-size attribute on document.documentElement whenever preferences change.

**Add this useEffect to PreferencesProvider (after the persistence useEffect):**

```typescript
// Apply preferences to DOM for CSS custom properties
useEffect(() => {
  document.documentElement.setAttribute('data-font-size', preferences.fontSize);
}, [preferences.fontSize]);
```

**Key points:**
- This sets the attribute on the `<html>` element, which :root CSS selectors target
- The effect runs on initial render with loaded preferences, applying the saved/default font size
- The effect re-runs whenever fontSize changes, providing immediate visual feedback
- Dependency array includes only `preferences.fontSize` for targeted re-renders

**Note for Plan 05-03:** Plan 05-03 will add a similar line for data-density to this same component. When 05-03 runs, it should add the density setAttribute call. The final result will have both attributes set in the effect(s).
  </action>
  <verify>
Run dev server, open DevTools Elements tab.
Check that `<html>` element has `data-font-size="medium"` attribute (the default).
Verify font-size CSS applies correctly.
  </verify>
  <done>
PreferencesContext sets data-font-size attribute on document.documentElement whenever preferences.fontSize changes. Initial load applies default or stored font size.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add font size control UI to PreferencesSettings</name>
  <files>
    frontend/src/pages/PreferencesSettings.tsx
    frontend/public/locales/en/settings.json
    frontend/public/locales/zh-TW/settings.json
  </files>
  <action>
Add a font size selector to the Appearance section of PreferencesSettings.

**Update PreferencesSettings.tsx:**

1. Add imports:
```typescript
import { usePreferences } from '@/contexts/PreferencesContext';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
```

2. Inside the component, get preferences:
```typescript
const { preferences, updatePreferences } = usePreferences();
```

3. Add font size control inside the Appearance Card's CardContent (after theme control):

```tsx
<div className="flex items-center justify-between">
  <Label htmlFor="font-size" className="flex flex-col gap-1">
    <span>{t('preferences.sections.appearance.fontSize.label')}</span>
    <span className="font-normal text-sm text-muted-foreground">
      {t('preferences.sections.appearance.fontSize.description')}
    </span>
  </Label>
  <Select
    value={preferences.fontSize}
    onValueChange={(value: 'small' | 'medium' | 'large') =>
      updatePreferences({ fontSize: value })
    }
  >
    <SelectTrigger id="font-size" className="w-[140px]">
      <SelectValue />
    </SelectTrigger>
    <SelectContent>
      <SelectItem value="small">{t('preferences.sections.appearance.fontSize.small')}</SelectItem>
      <SelectItem value="medium">{t('preferences.sections.appearance.fontSize.medium')}</SelectItem>
      <SelectItem value="large">{t('preferences.sections.appearance.fontSize.large')}</SelectItem>
    </SelectContent>
  </Select>
</div>
```

**Update settings.json translations:**

In `frontend/public/locales/en/settings.json`, add under preferences.sections.appearance:
```json
"fontSize": {
  "label": "Font Size",
  "description": "Adjust text size across the application",
  "small": "Small",
  "medium": "Medium",
  "large": "Large"
}
```

In `frontend/public/locales/zh-TW/settings.json`, add same structure:
```json
"fontSize": {
  "label": "字體大小",
  "description": "調整應用程式的文字大小",
  "small": "小",
  "medium": "中",
  "large": "大"
}
```
  </action>
  <verify>
Navigate to Settings > User Preferences in the browser.
Font Size dropdown should appear below Theme toggle.
Select "Large" - all text should scale up immediately.
Refresh page - setting should persist (still Large).
  </verify>
  <done>
PreferencesSettings shows Font Size selector with Small/Medium/Large options. Selection updates immediately and persists across sessions. Both English and Traditional Chinese translations added.
  </done>
</task>

</tasks>

<verification>
1. Navigate to /settings/preferences in dev server
2. Verify Font Size dropdown appears in Appearance section
3. Select each option (Small/Medium/Large) and verify text scales globally
4. Refresh page - font size setting persists
5. Check DevTools: html element has correct data-font-size attribute
6. Switch language to Traditional Chinese - labels translate correctly
7. Run `npm run build --prefix frontend` - builds without errors
</verification>

<success_criteria>
1. Font Size selector appears in Preferences Settings page
2. Selecting Small/Medium/Large visibly changes text size across app
3. data-font-size attribute updates on html element
4. Font size persists in localStorage and survives page refresh
5. English and Traditional Chinese translations work
6. No TypeScript or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-preferences-system/05-02-SUMMARY.md`
</output>
